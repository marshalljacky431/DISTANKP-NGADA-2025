<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Analitik Penyerapan Anggaran SIPD</title>
    
    <!-- Menambahkan Bootstrap untuk desain responsif -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Menambahkan Font Awesome untuk icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    
    <!-- Styling tambahan untuk layout -->
    <style>
        body {
            background-color: #f4f6f9;
            font-family: 'Arial', sans-serif;
        }

        .container {
            margin-top: 50px;
        }

        h1 {
            color: #343a40;
            margin-bottom: 30px;
        }

        .card {
            margin-bottom: 30px;
        }

        .card-header {
            background-color: #007bff;
            color: white;
            font-weight: bold;
            font-size: 18px;
        }

        .card-body {
            padding: 30px;
        }

        .card-body canvas {
            max-height: 400px;
        }

        .btn-primary {
            background-color: #007bff;
            border: none;
            font-weight: bold;
        }

        .btn-primary:hover {
            background-color: #0056b3;
        }

        .input-group {
            margin-bottom: 30px;
        }

        .input-group-text {
            background-color: #007bff;
            color: white;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1 class="text-center">Dashboard Analitik Penyerapan Anggaran SIPD</h1>
        
        <!-- Form untuk memilih file CSV -->
        <div class="input-group mb-4">
            <div class="input-group-prepend">
                <span class="input-group-text">Pilih File CSV</span>
            </div>
            <input type="file" class="form-control" id="fileInput" accept=".csv">
            <div class="input-group-append">
                <button class="btn btn-primary" onclick="loadCSV()">Muatan Data</button>
            </div>
        </div>

        <!-- Kartu untuk menampilkan grafik Pagu vs Realisasi Anggaran -->
        <div class="card">
            <div class="card-header">
                <i class="fas fa-chart-bar"></i> Pagu vs Realisasi Anggaran
            </div>
            <div class="card-body">
                <canvas id="anggaranChart"></canvas>
            </div>
        </div>

        <!-- Kartu untuk menampilkan grafik Progres Penyerapan Anggaran -->
        <div class="card">
            <div class="card-header">
                <i class="fas fa-tachometer-alt"></i> Progres Penyerapan Anggaran
            </div>
            <div class="card-body">
                <canvas id="progresChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Menambahkan jQuery dan PapaParse untuk mengolah CSV -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    
    <!-- Menambahkan Chart.js untuk visualisasi -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // Fungsi untuk memuat file CSV
        function loadCSV() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];

            if (file) {
                Papa.parse(file, {
                    complete: function(results) {
                        console.log("Data CSV:", results.data);
                        processData(results.data);
                    },
                    header: true // Jika CSV memiliki header
                });
            }
        }

        // Fungsi untuk memproses data CSV
        function processData(data) {
            const labels = [];
            const paguData = [];
            const realisasiData = [];
            const progresData = [];

            // Proses setiap baris data
            data.forEach(row => {
                labels.push(row["Bidang"]);  // Kolom Bidang
                paguData.push(parseInt(row["Pagu Anggaran"]));  // Kolom Pagu Anggaran
                realisasiData.push(parseInt(row["Realisasi Anggaran"]));  // Kolom Realisasi Anggaran
                progresData.push(parseInt(row["Progres"]));  // Kolom Progres Penyerapan
            });

            // Format angka dengan pemisah ribuan
            function formatCurrency(number) {
                return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR' }).format(number);
            }

            // Menampilkan grafik Pagu vs Realisasi
            const ctxAnggaran = document.getElementById('anggaranChart').getContext('2d');
            new Chart(ctxAnggaran, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Pagu Anggaran',
                        data: paguData, // Pagu Anggaran tetap berupa angka
                        backgroundColor: 'rgba(54, 162, 235, 0.6)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }, {
                        label: 'Realisasi Anggaran',
                        data: realisasiData, // Realisasi Anggaran tetap berupa angka
                        backgroundColor: 'rgba(255, 99, 132, 0.6)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value); // Menampilkan angka format mata uang pada sumbu Y
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(tooltipItem) {
                                    return formatCurrency(tooltipItem.raw); // Menampilkan angka format mata uang pada tooltip
                                }
                            }
                        }
                    }
                }
            });

            // Menampilkan grafik Progres Penyerapan
            const ctxProgres = document.getElementById('progresChart').getContext('2d');
            new Chart(ctxProgres, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Progres (%)',
                        data: progresData,
                        backgroundColor: 'rgba(153, 102, 255, 0.6)',
                        borderColor: 'rgba(153, 102, 255, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
    </script>

</body>
</html>
